<?xml version="1.0" encoding="utf-8"?>

<mechanics book="24" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/www/data/mechanics.xsd">

    <!-- GAME RULES -->
    <sections>
        <section id="tssf">
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Restore Deliverance use each X days -->
            <restoreDeliveranceUse />
            <!-- Reset Curing EP Used counter-->
            <resetNewOrderCuringEPRestoredUse />
            <!-- Rest any disabled disciplines -->
            <resetNewOrderDisabledDisciplines />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="kainame">
            <!-- Select the player Kai name UI -->
            <setKaiName />
        </section>
        
        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="5">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map">
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack">
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 20" excessToKaiMonastry="false" />
            </randomTable>

            <object objectId="axe" />
            <object objectId="sword" />
            <object objectId="quiver" count="6" />
            <object objectId="lute" />
            <object objectId="dagger" />
            <object objectId="bow" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="broadsword" />

            <test not="true" hasObject="spawnsmite|alema|magnara|sunstrike|kaistar|valiance|ulnarias|raumas|illuminatus|firefall">
                <randomTable index="1">
                    <case value="0">
                        <pick objectId="spawnsmite"/>
                    </case>
                    <case value="1">
                        <pick objectId="alema"/>
                    </case>
                    <case value="2">
                        <pick objectId="magnara"/>
                    </case>
                    <case value="3">
                        <pick objectId="sunstrike"/>
                    </case>
                    <case value="4">
                        <pick objectId="kaistar"/>
                    </case>
                    <case value="5">
                        <pick objectId="valiance"/>
                    </case>
                    <case value="6">
                        <pick objectId="ulnarias"/>
                    </case>
                    <case value="7">
                        <pick objectId="raumas"/>
                    </case>
                    <case value="8">
                        <pick objectId="illuminatus"/>
                    </case>
                    <case value="9">
                        <pick objectId="firefall"/>
                    </case>
                </randomTable>
            </test>

            <chooseEquipment text="Click on the Random Table links to get money and a Kai Weapon before continuing" />

            <numberPicker money="true" currency="crown" text="You may choose the number of Gold Crowns to exchange for Ren" min="1" actionButton="Exchange" />
            <numberPickerChoosed>
                <pick class="money" count="-[NUMBERPICKER]" />
                <pick class="money" count="[NUMBERPICKER] * 10" currency="ren" />
                <numberPicker enabled="false" />
            </numberPickerChoosed>
            <message text="You may take up to five of the following (all meals count as one object):" />
        </section>

        <section id="kaiwisdm">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
        </section>

        <section id="sect3">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect30" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect218" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test hasDiscipline="assimila">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect4">
            <endurance count="-1" />

            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect5">
            <choiceState section="sect286" set="disabled" />
            <test hasDiscipline="deliver">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect286" set="enabled" />
                    <choiceState section="sect114" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect6">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect8">
            <endurance count="-2" />
        </section>

        <section id="sect9">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect12">
            <choiceState section="sect146" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect146" set="enabled" />
                <choiceState section="sect47" set="disabled" />
            </test>
        </section>

        <section id="sect13">
            <meal huntDisabled="true" />
        </section>

        <section id="sect15">
            <endurance count="-2" />
        </section>

        <section id="sect16">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect30" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect218" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test hasDiscipline="assimila">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect19">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect20">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect167" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect192" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect22">
            <endurance count="-2" />
        </section>

        <section id="sect23">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="bardsman">
                <test expression="[KAILEVEL] &gt;= 8">
                    <choiceState section="sect86" set="enabled" />
                </test>
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect76" set="enabled" />
            </test>
            <choiceState section="sect127" set="enabled" />
        </section>

        <section id="sect24">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect25">
            <test not="true" hasDiscipline="bardsman">
                <choiceState section="sect74" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect179" set="disabled" />
            </test>
        </section>

        <section id="sect29">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect30">
            <endurance count="-3" />
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect331" set="disabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect105" set="enabled" />
            </test>
        </section>

        <section id="sect31">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect33">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect267" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect122" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect35">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect69" set="enabled" />
            </test>
            <test hasDiscipline="element">
                <test expression="[KAILEVEL] &gt;= 8">
                    <choiceState section="sect316" set="enabled" />
                </test>
            </test>
            <test canUseBow="true">
                <choiceState section="sect238" set="enabled" />
            </test>
            <choiceState section="sect73" set="enabled" />
        </section>

        <section id="sect37">
            <meal />
        </section>

        <section id="sect38">
            <choiceState section="sect337" set="disabled" />
            <test hasDiscipline="nexus">
                <choiceState section="sect337" set="enabled" />
                <choiceState section="sect22" set="disabled" />
            </test>
        </section>

        <section id="sect39">
            <message id="msg-drop-weapon" text="Drop one hand weapon of your choice" />

            <onInventoryEvent>
                <test expression="[WEAPON-ITEMS-CNT-ON-ACTIONCHART] - [BOW-CNT-ON-ACTIONCHART] === 0 || [WEAPON-ITEMS-CNT-ON-SECTION] - [BOW-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="hide"/>
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[WEAPON-ITEMS-CNT-ON-ACTIONCHART] - [BOW-CNT-ON-ACTIONCHART] === 0 || [WEAPON-ITEMS-CNT-ON-SECTION] - [BOW-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="show"/>
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect40">
             <choiceState section="all" set="disabled" />
             <test hasObject="potiongallowbrush">
                <choiceState section="sect87" set="enabled" />
             </test>
             <test hasObject="graveweedconcentrate">
                <choiceState section="sect195" set="enabled" />
             </test>
             <test hasObject="mokradonpotion">
                <choiceState section="sect327" set="enabled" />
             </test>
             <test hasObject="volzocpotion">
                <choiceState section="sect169" set="enabled" />
             </test>
             <test hasObject="ghilev">
                <choiceState section="sect271" set="enabled" />
             </test>
             <choiceState section="sect31" set="enabled" />
        </section>

        <section id="sect41">
            <endurance count="-4" />
        </section>

        <section id="sect43">
            <endurance count="-3" />
            <meal />
        </section>

        <section id="sect44">
            <test canUseBow="false">
                <choiceState section="sect291" set="disabled" />
            </test>
        </section>

        <section id="sect45">
            <pick class="money" count="-10" />
        </section>

        <section id="sect49">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect52">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <test expression="[COMBATSDURATION] &lt;= 5">
                    <choiceState section="sect187" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect35" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect53">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <combat damageMultiplier="0.5"  />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect54">
            <object objectId="dungeonkeys" />
        </section>

        <section id="sect55">
            <test canUseBow="false">
                <choiceState section="sect242" set="disabled" />
            </test>
        </section>

        <section id="sect57">
            <endurance count="-2" />
        </section>

        <section id="sect58">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect59">
            <choiceState section="sect259" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect259" set="enabled" />
                <choiceState section="sect180" set="disabled" />
            </test>
        </section>

        <section id="sect61">
            <choiceState section="all" set="disabled" />
            <endurance count="-4" />
            <disciplinePicker actionButton="Disable Discipline" confirmText="confirmDisableDiscipline" text="Choose a Grand Master Discipline to disable for the rest of this mission" />
            <disciplinePickerChoosed>
                <disableDiscipline disciplineIndex="[DISCIPLINEPICKER]" />
                <disciplinePicker enabled="false"  />
                <choiceState section="all" set="enabled" />
            </disciplinePickerChoosed>
        </section>

        <section id="sect62">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <test expression="[RANDOM] % 2 == 0">
                    <endurance count="-4" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test expression="[RANDOM] % 2 == 1">
                    <endurance count="-2" />                        
                    <choiceState section="all" set="enabled" />
                </test>
            </randomTable>
        </section>

        <section id="sect63">
            <meal huntDisabled="true" />
        </section>

        <section id="sect65">
            <test expression="[MONEY] &lt; 10">
                <choiceState section="sect203" set="disabled" />
            </test>
        </section>

        <section id="sect66">
            <object objectId="arrow" unlimited="true" />
        </section>

        <section id="sect67">
            <endurance count="-6" />
            <message id="msg-drop-object" text="Drop 2 Backpack Items before continuing" />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] >= 2 || [BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0">
                    <choiceState section="all" set="enabled" />
                    <message id="msg-drop-object" op="hide" />
                </test>
                <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-SECTION] >= 2 || [BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0">
                    <choiceState section="all" set="disabled" />
                    <message id="msg-drop-object" op="show" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect68">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect70">
            <choiceState section="sect63" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect63" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect71">
            <object objectId="mace" />
            <object objectId="smallshovel" />
        </section>

        <section id="sect72">
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
        </section>

        <section id="sect73">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect75">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test not="true" hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="-3"/>
            </test>
            <afterCombatTurn turn="3">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
        </section>

        <section id="sect78">
            <meal />
        </section>

        <section id="sect79">
            <object objectId="hammer" />
            <object objectId="pliers" />
            <object objectId="pincers" />
            <object objectId="axe" />
            <object objectId="rope" />
            <object objectId="spike" />
            <object objectId="plane" />
            <object objectId="saw" />
        </section>

        <section id="sect80">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombatTurn turn="1">
                <disableCombats />
                <test expression="[COMBATSENDURANCELOST] &lt;= [COMBATSENEMYLOST]">
                    <choiceState section="sect64" set="enabled" />
                </test>
                <test not="true" expression="[COMBATSENDURANCELOST] &lt;= [COMBATSENEMYLOST]">
                    <choiceState section="sect111" set="enabled" />
                </test>
            </afterCombatTurn>
        </section>

        <section id="sect82">
            <choiceState section="sect199" set="disabled" />
            <test hasDiscipline="element">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect199" set="enabled" />
                    <choiceState section="sect25" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect83">
            <choiceState section="sect219" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect219" set="enabled" />
                <choiceState section="sect62" set="disabled" />
            </test>
        </section>

        <section id="sect84">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect85">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect87">
            <drop objectId="potiongallowbrush" />
        </section>

        <section id="sect91">
            <object objectId="tekarochalice" />
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect92">
            <choiceState section="all" set="disabled" />
            <combat />
            <test hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="+3" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect94">
            <endurance count="-4" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect30" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect218" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test hasDiscipline="assimila">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect95">
            <meal />
        </section>

        <section id="sect97">
            <choiceState section="sect2" set="disabled" />
            <test hasDiscipline="gnosis">
                <choiceState section="sect2" set="enabled" />
                <choiceState section="sect246" set="disabled" />
            </test>
        </section>

        <section id="sect99">
            <endurance count="-8" />
            <meal />
        </section>

        <section id="sect101">
            <choiceState section="all" set="disabled" />
            <combat enemyImmuneTurns="2" noWeapon="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect105">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect53" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect112" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect106">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect42" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect273" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect107">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect333" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect220" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect109">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect54" set="disabled" />
            </test>
            <test not="true" hasDiscipline="bardsman">
                <choiceState section="sect165" set="disabled" />
            </test>
        </section>

        <section id="sect110">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect111">
            <death />
        </section>
        
        <section id="sect117">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect235" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect78" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect118">
            <endurance count="-3" />
        </section>

        <section id="sect119">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect41" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect305" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect254" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect120">
            <choiceState section="sect308" set="disabled" />
            <test hasDiscipline="astrolgy">
                <choiceState section="sect308" set="enabled" />
                <choiceState section="sect231" set="disabled" />
            </test>
        </section>

        <section id="sect121">
            <meal />
        </section>

        <section id="sect124">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect57" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect244" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect126">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect127">
            <test not="true" hasDiscipline="element">
                <choiceState section="sect347" set="disabled" />
            </test>
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect279" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect151" set="disabled" />
            </test>
        </section>

        <section id="sect128">
            <object objectId="potiongallowbrush" />
            <object objectId="graveweedconcentrate" />
            <object objectId="mokradonpotion" />
            <object objectId="volzocpotion" />
        </section>

        <section id="sect129">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect133">
            <choiceState section="sect331" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect331" set="enabled" />
                <choiceState section="sect105" set="disabled" />
            </test>
        </section>

        <section id="sect134">
            <death />
        </section>

        <section id="sect135">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect67" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect284" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect171" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="nexus">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect136">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test not="true" hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="-3" />
            </test>
            <afterCombatTurn turn="3">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
        </section>

        <section id="sect138">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect140">
            <choiceState section="sect349" set="disabled" />
            <test hasDiscipline="kaisurge|kaiscrn">
                <choiceState section="sect349" set="enabled" />
                <choiceState section="sect256" set="disabled" />
            </test>
        </section>
        
        <section id="sect141">
            <choiceState section="sect86" set="disabled" />
            <choiceState section="sect76" set="disabled" />
            <test hasDiscipline="bardsman">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect86" set="enabled" />
                    <choiceState section="sect127" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect76" set="enabled" />
                <choiceState section="sect127" set="disabled" />
            </test>
        </section>

        <section id="sect144">
            <test not="true" hasDiscipline="element">
                <choiceState section="sect269" set="disabled" />
            </test>
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect176" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect48" set="disabled" />
            </test>
        </section>

        <section id="sect145">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect118" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect15" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect322" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect148">
            <numberPicker text="Choose the number for the combination lock" min="100" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 280">
                    <goToSection section="sect280" />
                </test>
                <test expression="[NUMBERPICKER] != 280">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect149">
            <test not="true" hasDiscipline="assimila">
                <choiceState section="sect194" set="disabled" />
            </test>
            <test hasDiscipline="assimila">
                <choiceState section="sect70" set="disabled" />
            </test>
        </section>

        <section id="sect150">
            <endurance count="-1" />
        </section>

        <section id="sect152">
            <test not="true" hasDiscipline="anmlmstr">
                <choiceState section="sect311" set="disabled" />
            </test>
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect106" set="disabled" />
            </test>
        </section>

        <section id="sect153">
            <endurance count="-3" />
            <meal />
        </section>

        <section id="sect154">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" 
            combatSkillModifier="-7" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombatTurn turn="3">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
        </section>

        <section id="sect155">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect57" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect244" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect156">
            <choiceState section="all" set="disabled" />
            <pick objectId="kaiclothes" />
            <test not="true" objectOnSection="kaiclothes">
                <choiceState section="all" set="enabled" />
            </test>
        </section>

        <section id="sect157">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect282" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect264" set="disabled" />
            </test>
        </section>

        <section id="sect158">
            <numberPicker text="Choose the number for the combination lock" min="100" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 221">
                    <goToSection section="sect221" />
                </test>
                <test expression="[NUMBERPICKER] != 221">
                    <toast text="Wrong number!" />
                    <numberPicker enabled="false" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect159">
            <test expression="[MONEY] &lt; 10">
                <choiceState section="sect45" set="disabled" />
            </test>
        </section>

        <section id="sect160">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <test expression="[COMBATSDURATION] &lt;= 5">
                    <choiceState section="sect187" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 6">
                    <choiceState section="sect35" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect161">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect162">
            <meal huntDisabled="true" />
        </section>
        
        <section id="sect163">
            <drop objectId="phosphorbomb" />
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect24" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect277" set="disabled" />
            </test>
        </section>

        <section id="sect165">
            <object objectId="dungeonkeys" />
        </section>

        <section id="sect166">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect167">
            <test not="true" hasDiscipline="element">
                <choiceState section="sect33" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect332" set="disabled" />
            </test>
        </section>

        <section id="sect168">
            <test canUseBow="false">
                <choiceState section="sect6" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect131" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect342" set="disabled" />
            </test>
        </section>

        <section id="sect169">
            <drop objectId="volzocpotion" />
        </section>

        <section id="sect172">
            <endurance count="-4" />
        </section>

        <section id="sect174">
            <choiceState section="sect321" set="disabled" />
            <test hasDiscipline="assimila">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect321" set="enabled" />
                </test>
            </test>
            <test not="true" hasDiscipline="element">
                <choiceState section="sect201" set="disabled" />
            </test>
        </section>

        <section id="sect175">
            <test not="true" hasObject="redvial">
                <choiceState section="sect182" set="disabled" />
            </test>
            <test not="true" hasObject="bluevial">
                <choiceState section="sect136" set="disabled" />
            </test>
            <test not="true" hasObject="yellowvial">
                <choiceState section="sect154" set="disabled" />
            </test>
        </section>

        <section id="sect178">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect300" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect80" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
            <test weaponskillActive="true">
                <test currentWeapon="spawnsmite|alema|magnara|sunstrike|kaistar|valiance|ulnarias|raumas|illuminatus|firefall">
                    <randomTableIncrement increment="+2" /> 
                </test>
            </test>
            <test hasDiscipline="anmlmstr">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect180">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect167" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect192" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect182">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="+3"/>
            </test>
            <afterCombatTurn turn="3">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
        </section>

        <section id="sect185">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect186">
            <object objectId="phosphorbomb" />
        </section>

        <section id="sect188">
            <meal />
        </section>

        <section id="sect189">
            <meal />
        </section>

        <section id="sect190">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect84" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect217" set="disabled" />
            </test>
        </section>

        <section id="sect191">
            <test not="true" hasDiscipline="kaiscrn">
                <choiceState section="sect150" set="disabled" />
            </test>
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect61" set="disabled" />
            </test>
        </section>

        <section id="sect194">
            <meal huntDisabled="true" />
        </section>

        <section id="sect195">
            <drop objectId="graveweedconcentrate" />
        </section>

        <section id="sect196">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect197">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect172" set="enabled" />
                </case>
                <case from="3" to="7">
                    <choiceState section="sect8" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect346" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect198">
            <test not="true" hasObject="dungeonkeys">
                <choiceState section="sect208" set="disabled" />
            </test>
            <test hasObject="dungeonkeys">
                <choiceState section="sect38" set="disabled" />
            </test>
        </section>

        <section id="sect201">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect43" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect95" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect203">
            <pick class="money" count="-10" />
        </section>

        <section id="sect204">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect206">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="4" noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect209">
            <choiceState section="sect289" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect289" set="enabled" />
                <choiceState section="sect334" set="disabled" />
            </test>
        </section>

        <section id="sect210">
            <choiceState section="sect233" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect233" set="enabled" />
                <choiceState section="sect20" set="disabled" />
            </test>
        </section>

        <section id="sect211">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifierIncrement="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect213">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect214">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect130" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect29" set="disabled" />
            </test>
            <test not="true" hasDiscipline="kaisurge">
                <choiceState section="sect4" set="disabled" />
            </test>
            <test not="true" hasDiscipline="anmlmstr" hasObject="eyeoflhaz">
                <choiceState section="sect96" set="disabled" />
            </test>
        </section>

        <section id="sect216">
            <endurance count="-5" />
            <meal />
        </section>

        <section id="sect217">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect218">
            <choiceState section="sect331" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect331" set="enabled" />
                <choiceState section="sect105" set="disabled" />
            </test>
        </section>

        <section id="sect220">
            <endurance count="-1" />
            <meal />
        </section>

        <section id="sect221">
            <choiceState section="sect349" set="disabled" />
            <test hasDiscipline="kaisurge|kaiscrn">
                <choiceState section="sect349" set="enabled" />
                <choiceState section="sect256" set="disabled" />
            </test>
        </section>

        <section id="sect222">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <case to="3">
                    <choiceState section="sect232" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect81" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect223">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect224">
            <endurance count="-5" />
        </section>

        <section id="sect225">
            <object objectId="ghilev" />
        </section>

        <section id="sect226">
            <endurance count="+9" />
        </section>

        <section id="sect228">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect41" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect305" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect254" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect229">
            <death />
        </section>

        <section id="sect230">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect231">
            <test canUseBow="false">
                <choiceState section="sect56" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect113" set="disabled" />
            </test>
        </section>

        <section id="sect234">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect5" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect166" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect235">
            <endurance count="-2" />
            <meal />
        </section>

        <section id="sect237">
            <object objectId="arrow" price="1" unlimited="true" />
            <object objectId="dagger" price="3" unlimited="true" />
            <object objectId="quarterstaff" price="3" unlimited="true" />
            <object objectId="spear" price="5" unlimited="true" />
            <object objectId="shortsword" price="6" unlimited="true" />
            <object objectId="axe" price="6" unlimited="true" />
            <object objectId="mace" price="6" unlimited="true" />
            <object objectId="sword" price="7" unlimited="true" />
            <object objectId="warhammer" price="7" unlimited="true" />
            <object objectId="broadsword" price="9" unlimited="true" />
            <object objectId="bow" price="10" unlimited="true" />
        </section>

        <section id="sect242">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect245">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect249">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect107" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect302" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect252">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect99" set="enabled" />
                </case>
                <case from="4" to="8">
                    <choiceState section="sect216" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect153" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect255">
            <meal />
        </section>

        <section id="sect256">
            <object objectId="redvial" />
            <object objectId="bluevial" />
            <object objectId="yellowvial" />
        </section>

        <section id="sect258">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="7">
                    <choiceState section="sect245" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect278" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="+5" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>
        
        <section id="sect262">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect263">
            <test not="true" hasObject="tekarochalice">
                <choiceState section="sect335" set="disabled" />
            </test>
            <test hasObject="tekarochalice">
                <choiceState section="sect65" set="disabled" />
            </test>
        </section>

        <section id="sect264">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true"/>
            <test hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="+3" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect265">
            <choiceState section="all" set="disabled" />
            <combat enemyImmuneTurns="2" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect266">
            <meal />
        </section>

        <section id="sect267">
            <death />
        </section>

        <section id="sect268">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect336" set="disabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect281" set="disabled" />
            </test>
        </section>

        <section id="sect270">
            <test not="true" hasObject="tekarochalice">
                <choiceState section="sect296" set="disabled" />
            </test>
            <test hasObject="tekarochalice">
                <choiceState section="sect159" set="disabled" />
            </test>
        </section>

        <section id="sect271">
            <drop objectId="ghilev" />
        </section>

        <section id="sect272">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect5" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect166" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect274">
            <object objectId="potiongallowbrush" />
            <object objectId="graveweedconcentrate" />
            <object objectId="mokradonpotion" />
            <object objectId="volzocpotion" />
        </section>

        <section id="sect275">
            <endurance count="-3" />
            <meal />
        </section>

        <section id="sect277">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect278">
            <choiceState section="sect51" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect51" set="enabled" />
                    <choiceState section="sect294" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect280">
            <choiceState section="all" set="disabled" />
             <test hasObject="potiongallowbrush">
                <choiceState section="sect87" set="enabled" />
             </test>
             <test hasObject="graveweedconcentrate">
                <choiceState section="sect195" set="enabled" />
             </test>
             <test hasObject="mokradonpotion">
                <choiceState section="sect327" set="enabled" />
             </test>
             <test hasObject="volzocpotion">
                <choiceState section="sect169" set="enabled" />
             </test>
             <test hasObject="ghilev">
                <choiceState section="sect271" set="enabled" />
             </test>
             <choiceState section="sect31" set="enabled" />
        </section>

        <section id="sect281">
            <test not="true" hasDiscipline="element">
                <choiceState section="sect28" set="disabled" />
            </test>
            <test not="true" hasDiscipline="kaisurge">
                <choiceState section="sect125" set="disabled" />
            </test>
        </section>

        <section id="sect282">
            <choiceState section="all" set="disabled" />
            <combat />
            <test hasDiscipline="kaiscrn">
                <combat combatSkillModifierIncrement="+3" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <test currentWeapon="alema">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect283">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect193" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect101" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect284">
            <endurance count="-3" />
            <message id="msg-drop-item" text="Drop one Backpack Item of your choice" />

            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] === 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-item" op="hide"/>
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] === 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-item" op="show"/>
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect288">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <case to="3">
                    <choiceState section="sect11" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect341" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect289">
            <choiceState section="all" set="disabled" />
            <disciplinePicker actionButton="Disable Discipline" confirmText="confirmDisableDiscipline" text="Choose a Grand Master Discipline to disable for the rest of this mission" />
            <disciplinePickerChoosed>
                <disableDiscipline disciplineIndex="[DISCIPLINEPICKER]" />
                <disciplinePicker enabled="false"  />
                <choiceState section="all" set="enabled" />
            </disciplinePickerChoosed>
        </section>

        <section id="sect291">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect292">
            <object objectId="bowl" />
            <object objectId="mirror" />
            <object objectId="pitcher" />
            <object objectId="flute" />
        </section>

        <section id="sect293">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect294">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect67" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect284" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect171" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="nexus">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect295">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect267" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect122" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect296">
            <drop objectId="tekarochalice" />
        </section>

        <section id="sect297">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 40">
                    <goToSection section="sect40" />
                </test>
                <test expression="[NUMBERPICKER] != 40">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect299">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <test expression="[COMBATSDURATION] &lt;= 4">
                    <choiceState section="sect13" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect174" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect300">
            <death />
        </section>

        <section id="sect302">
            <meal />
        </section>

        <section id="sect304">
            <choiceState section="all" set="disabled" />
            <combat />
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect305">
            <endurance count="-2" />
        </section>

        <section id="sect306">
            <meal />
        </section>

        <section id="sect307">
            <endurance count="-3" />
        </section>

        <section id="sect310">
            <object objectId="tekarochalice" />
        </section>

        <section id="sect312">
            <choiceState section="all" set="disabled" />
            <combat enemyImmuneTurns="2" noWeapon="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect313">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect55" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect268" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect315">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect94" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect3" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect317">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noKaiSurge="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="illuminatus">
                <combat combatSkillModifierIncrement="+2" />
            </test>
            <test currentWeapon="spawnsmite">
                <combat combatSkillModifierIncrement="+1" />
            </test>
            <test currentWeapon="kaistar">
                <combat combatSkillModifierIncrement="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect318">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect5" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect166" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect319">
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect297" set="disabled" />
            </test>
            <test hasDiscipline="nexus">
                <choiceState section="sect148" set="disabled" />
            </test>
        </section>

        <section id="sect320">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect265" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect170" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect89" set="enabled" />
                </case>
            </randomTable>
            <test hasObject="dagger|spike">
                <randomTableIncrement increment="+1" />
            </test>
            <test hasDiscipline="nexus">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect321">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect275" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect306" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[KAILEVEL] - 5" />
        </section>

        <section id="sect322">
            <endurance count="-1" />
        </section>

        <section id="sect323">
            <object objectId="mace" />
            <object objectId="smallshovel" />
        </section>

        <section id="sect324">
            <meal />

            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect36" set="disabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect191" set="disabled" />
            </test>
        </section>

        <section id="sect326">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        
        </section>

        <section id="sect327">
            <drop objectId="mokradonpotion" />
        </section>

        <section id="sect328">
            <choiceState section="all" set="disabled" />
            <numberPicker actionButton="Choose" money="true" text="Choose how many Gold Crowns you are willing to pay for a night's lodging" />
            <numberPickerChoosed>
                <numberPicker enabled="false" />
                <randomTable>
                    <case to="8">
                        <choiceState section="sect32" set="enabled" />
                    </case>
                    <case from="9">
                        <choiceState section="sect234" set="enabled" />
                    </case>
                </randomTable>
                <randomTableIncrement increment="[NUMBERPICKER]" />
            </numberPickerChoosed>
            <choiceSelected section="sect234">
                <pick class="money" count="-[NUMBERPICKER]" />
            </choiceSelected>
        </section>

        <section id="sect333">
            <endurance count="-3" />
            <drop backpackItemSlots="1" />
            <meal />
        </section>

        <section id="sect334">
            <endurance count="-8" />
            <choiceState section="all" set="disabled" />
            <disciplinePicker actionButton="Disable Discipline" confirmText="confirmDisableDiscipline" text="Choose a Grand Master Discipline to disable for the rest of this mission" />
            <disciplinePickerChoosed>
                <disableDiscipline disciplineIndex="[DISCIPLINEPICKER]" />
                <disciplinePicker enabled="false"  />
                <choiceState section="all" set="enabled" />
            </disciplinePickerChoosed>
        </section>

        <section id="sect335">
            <drop objectId="tekarochalice" />
        </section>

        <section id="sect339">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect224" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect307" set="enabled" />
                </case>
                <case from="10">
                    <choiceState section="sect103" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
            <test hasDiscipline="nexus">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect340">
            <test not="true" hasObject="phosphorbomb">
                <choiceState section="sect163" set="disabled" />
            </test>
            <test hasObject="phosphorbomb">
                <choiceState section="sect190" set="disabled" />
            </test>
        </section>

        <section id="sect343">
            <pick objectId="skulltorwristband" />
            <pick objectId="battlemap" />

            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="7">
                    <choiceState section="sect14" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect212" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect344">
            <test not="true" hasDiscipline="herbmst">
                <choiceState section="sect225" set="disabled" />
            </test>
            <test hasDiscipline="herbmst">
                <choiceState section="sect298" set="disabled" />
            </test>
        </section>

        <section id="sect345">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect36" set="disabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect191" set="disabled" />
            </test>
        </section>

        <section id="sect348">
            <choiceState section="all" set="disabled" />
            <pick objectId="kaiclothes" />
            <test not="true" objectOnSection="kaiclothes">
                <choiceState section="all" set="enabled" />
            </test>
        </section>

        <section id="sect349">
            <object objectId="redvial" />
            <object objectId="bluevial" />
            <object objectId="yellowvial" />
        </section>

        <section id="sect350">
            <message text="Congratulations! You have finished the last book of Kai Chronicles!" />
        </section>
    </sections>
</mechanics>