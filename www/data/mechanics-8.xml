<?xml version="1.0" encoding="utf-8"?>

<mechanics book="8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/www/data/mechanics.xsd">

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="5">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map">
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack">
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" excessToKaiMonastry="true" />
            </randomTable>

            <!-- Kai monastery safekeeping -->
            <kaiMonasteryStorage />

            <object objectId="sword" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="lantern" />
            <object objectId="mace" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="dagger" />
            <object objectId="fireseed" count="3" />

            <chooseEquipment text="Click on the Random Table link to get money before continuing" />

            <message text="You may take up to five of the following (all meals and fireseeds count as one object):" />
        </section>

        <section id="sect1">
            <tag id="talestria" />
            <choiceState section="all" set="disabled" />
            <pick objectId="pass" />
            <onInventoryEvent>
                <test hasObject="pass">
                    <choiceState section="all" set="enabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect2">
            <choiceState section="sect116" set="disabled" />
            <test hasDiscipline="psiscrn">
                <choiceState section="sect116" set="enabled" />
                <choiceState section="sect315" set="disabled" />
                <choiceState section="sect177" set="disabled" />
            </test>
        </section>

        <section id="sect4">
            <test canUseBow="false">
                <choiceState section="sect310" set="disabled" />
            </test>
        </section>

        <section id="sect5">
            <test canUseBow="false">
                <choiceState section="sect324" set="disabled" />
            </test>
            <choiceSelected section="sect324">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect7">
            <object objectId="silverbox" />
        </section>

        <section id="sect8">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test not="true" hasDiscipline="anmlctrl">
                <combat combatSkillModifier="-3" />
            </test>
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect9">
            <test not="true" hasObject="fireseed">
                <choiceState section="sect207" set="disabled" />
            </test>
            <choiceSelected section="sect207">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect12">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect341" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect122" set="disabled" />
            </test>
        </section>

        <section id="sect13">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceCS="-2" index="0" />
            <combat noMindblast="true" mindforceCS="-2" index="1" />
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" index="0" />
                <combat damageMultiplier="2" index="1" />
            </test>
            <afterCombatTurn turn="any">
                <!-- Use the following construction rather than turn="6" above because afterCombatTurn is per-combat, not across combats -->
                <test expression="[COMBATSDURATION] >= 6">
                    <test combatsWon="false">
                        <disableCombats />
                        <choiceState section="sect158" set="enabled" />
                    </test>
                </test>
            </afterCombatTurn>
            <afterCombats>
                <test combatsWon="true">
                    <choiceState section="sect79" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect14">
            <test not="true" hasObject="pass">
                <choiceState section="sect180" set="disabled" />
            </test>
        </section>

        <section id="sect15">
            <endurance count="-2" />
        </section>

        <section id="sect16">
            <pick class="money" count="20" currency="lune" />
        </section>

        <section id="sect17">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="7">
                    <choiceState section="sect6" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect77" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleFire">
                <test hasCircle="circleLight">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
            <randomTableIncrement increment="[BOWBONUS]" />
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect18">
            <choiceState section="all" set="disabled" />
            <endurance count="-2" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect57" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect234" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlctrl|hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
            <test expression="[KAILEVEL] >= 4">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect21">
            <death />
        </section>

        <section id="sect22">
            <choiceState section="sect327" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect327" set="enabled" />
                <choiceState section="sect14" set="disabled" />
                <choiceState section="sect78" set="disabled" />
            </test>
        </section>

        <section id="sect27">
            <choiceState section="sect131" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect131" set="enabled" />
                    <choiceState section="sect47" set="disabled" />
                    <choiceState section="sect211" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect28">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect38" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect125" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect30">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceEP="-2" />
            <test hasCircle="circleSpirit">
                <combat combatSkillModifier="+2" />
            </test>
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect31">
            <!-- 
                See sect156 
                <test not="true" sectionVisited="sect156">
                    <choiceState section="sect237" set="disabled" />
                </test>
                <test sectionVisited="sect156">
                    <choiceState section="sect91" set="disabled" />
                </test>
            -->
            <test not="true" isGlobalRuleRegistered="book8sect156">
                <choiceState section="sect237" set="disabled" />
            </test>
            <test isGlobalRuleRegistered="book8sect156">
                <choiceState section="sect91" set="disabled" />
            </test>
        </section>

        <section id="sect36">
            <test canUseBow="false">
                <choiceState section="sect182" set="disabled" />
            </test>
            <test not="true" hasObject="fireseed">
                <choiceState section="sect225" set="disabled" />
            </test>
            <choiceSelected section="sect182">
                <pick class="arrow" count="-1" />
            </choiceSelected>
            <choiceSelected section="sect225">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect38">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" />
            <afterCombats>
                <choiceState section="sect9" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect309" set="enabled" />
            </afterElude>
        </section>

        <section id="sect39">
            <endurance count="-8" />
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect131" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 5">
                <choiceState section="sect131" set="disabled" />
            </test>
        </section>

        <section id="sect40">
            <choiceState section="all" set="disabled" />
            <endurance count="-2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect41">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="+5" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect42">
            <object objectId="potionofstrength" />
            <object objectId="laumspurpotion4" />
            <object objectId="broadsword" />
            <object objectId="quarterstaff" />
            <object objectId="rendalimelixir" />
            <object objectId="tinctureoxydine" />
        </section>

        <section id="sect45">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect155" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect167" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect47">
            <choiceState section="all" set="disabled" />

            <pick objectId="paidosword" />
            <currentWeapon objectId="paidosword" />
            <message id="msg-drop-weapon" text="You must use the Paido sword as current weapon on this combat" />
            <onInventoryEvent>
                <disableCombats />
                <test currentWeapon="paidosword">
                    <disableCombats disabled="false" />
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" mindforceEP="-2" />
            <test hasCircle="circleSpirit">
                <combat combatSkillModifier="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect49">
            <choiceState section="sect257" set="disabled" />
            <test not="true" hasDiscipline="psisurge">
                <choiceState section="sect84" set="disabled" />
                <choiceState section="sect257" set="enabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 4">
                <choiceState section="sect84" set="disabled" />
                <choiceState section="sect257" set="enabled" />
            </test>
        </section>

        <section id="sect51">
            <death />
        </section>

        <section id="sect52">
            <choiceState section="all" set="disabled" />
            <combat enemyMultiplier="2" mindblastMultiplier="3" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect54">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect134" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect219" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test hasDiscipline="dvnation">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect57">
            <death />
        </section>

        <section id="sect58">
            <test not="true" hasDiscipline="pthmnshp">
                <choiceState section="sect108" set="disabled" />
            </test>
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect335" set="disabled" />
            </test>
        </section>

        <section id="sect59">
            <pick class="money" count="40" currency="lune" />
        </section>

        <section id="sect60">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect308" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect248" set="disabled" />
            </test>
        </section>

        <section id="sect61">
            <test not="true" hasDiscipline="invsblty">
                <choiceState section="sect95" set="disabled" />
            </test>
            <test hasDiscipline="invsblty">
                <choiceState section="sect210" set="disabled" />
            </test>
        </section>

        <section id="sect64">
            <object objectId="sackofsilver" unlimited="true" />
        </section>

        <section id="sect66">
            <endurance count="-2" />
        </section>

        <section id="sect69">
            <death />
        </section>

        <section id="sect71">
            <!-- -5 now, add +2 back at end of book -->
            <combatSkill count="-5" />
        </section>

        <section id="sect72">
            <choiceState section="sect270" set="disabled" />
            <test hasDiscipline="dvnation" expression="[KAILEVEL] >= 5">
                <choiceState section="sect270" set="enabled" />
                <choiceState section="sect32" set="disabled" />
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect73">
            <choiceState section="sect23" set="disabled" />
            <test hasDiscipline="psiscrn">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect23" set="enabled" />
                    <choiceState section="sect325" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect74">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="15 - [ORIGINALCOMBATSKILL]" mentalOnly="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect75">
            <death />
        </section>

        <section id="sect77">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="1">
                    <choiceState section="sect51" set="enabled" />
                </case>
                <case from="2">
                    <choiceState section="sect43" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect78">
            <test not="true" expression="[MEALS] >= 1">
                <choiceState section="sect217" set="disabled" />
            </test>
            <choiceSelected section="sect217">
                <drop objectId="meal" />
            </choiceSelected>
            <choiceSelected section="sect174">
                <endurance count="-3" />
            </choiceSelected>
        </section>

        <section id="sect79">
            <choiceState section="sect319" set="disabled" />
            <choiceState section="sect25" set="disabled" />

            <test hasDiscipline="dvnation">
                <choiceState section="sect319" set="enabled" />
                <choiceState section="sect243" set="disabled" />
            </test>
            <test hasDiscipline="psisurge">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect25" set="enabled" />
                    <choiceState section="sect243" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect80">
            <choiceState section="sect179" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect179" set="enabled" />
                    <choiceState section="sect312" set="disabled" />
                    <choiceState section="sect255" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect81">
            <endurance count="-12" />
        </section>

        <section id="sect83">
            <endurance count="-5" />
        </section>

        <section id="sect84">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect341" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect122" set="disabled" />
            </test>
        </section>

        <section id="sect85">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect94" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect298" set="disabled" />
            </test>
        </section>

        <section id="sect86">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <choiceState section="all" set="enabled" />
                <endurance count="-[RANDOM]" />
            </randomTable>
        </section>

        <section id="sect87">
            <drop objectId="silverbowduadon" />
        </section>

        <section id="sect88">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <combat combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect89">
            <test not="true" expression="[MONEY] >= 10">
                <choiceState section="sect266" set="disabled" />
            </test>
            <choiceSelected section="sect266">
                <pick class="money" count="-10" />
            </choiceSelected>
        </section>

        <section id="sect91">
            <choiceState section="sect11" set="disabled" />
            <test hasDiscipline="dvnation">
                <choiceState section="sect11" set="enabled" />
                <choiceState section="sect274" set="disabled" />
                <choiceState section="sect66" set="disabled" />
            </test>
        </section>

        <section id="sect93">
            <test canUseBow="false">
                <choiceState section="sect161" set="disabled" />
            </test>
            <choiceSelected section="sect161">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect95">
            <test canUseBow="false">
                <choiceState section="sect196" set="disabled" />
            </test>
            <choiceSelected section="sect196">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect96">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect19" set="disabled" />
            </test>
            <test hasDiscipline="curing">
                <choiceState section="sect317" set="disabled" />
            </test>
        </section>

        <section id="sect97">
            <endurance count="-1" />
        </section>

        <section id="sect100">
            <choiceSelected section="sect239">
                <endurance count="[MAXENDURANCE] - [ENDURANCE]" />
            </choiceSelected>
        </section>

        <section id="sect101">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test not="true" hasDiscipline="anmlctrl">
                <combat combatSkillModifier="-3" />
            </test>
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect102">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect278" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect150" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect104">
            <endurance count="-2" />
        </section>

        <section id="sect105">
            <meal />
        </section>

        <section id="sect106">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <combat combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect110">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" eludeTurn="3" />
            <afterCombats>
                <choiceState section="sect293" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect191" set="enabled" />
            </afterElude>
        </section>

        <section id="sect112">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 3">
                    <goToSection section="sect3" />
                </test>
                <test expression="[NUMBERPICKER] != 3">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect113">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect30" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect183" set="disabled" />
            </test>
        </section>

        <section id="sect115">
            <endurance count="-8" />
        </section>

        <section id="sect116">
            <test not="true" expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] > 0">
                <choiceState section="sect214" set="disabled" />
            </test>
        </section>

        <section id="sect117">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect154" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect40" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect251" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 4">
                    <randomTableIncrement increment="+1" />
                </test>
            </test>
        </section>

        <section id="sect121">
            <death />
        </section>

        <section id="sect122">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect115" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect334" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect123">
            <test not="true" hasObject="fireseed">
                <choiceState section="sect81" set="disabled" />
            </test>
            <choiceSelected section="sect81">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect125">
            <test canUseBow="false">
                <choiceState section="sect90" set="disabled" />
            </test>
            <choiceSelected section="sect90">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect126">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 16">
                    <goToSection section="sect16" />
                </test>
                <test expression="[NUMBERPICKER] != 16">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect127">
            <test canUseBow="false">
                <choiceState section="sect209" set="disabled" />
            </test>
        </section>

        <section id="sect129">
            <meal />
        </section>

        <section id="sect130">
            <test not="true" sectionVisited="sect262">
                <choiceState section="sect329" set="disabled" />
            </test>
            <test sectionVisited="sect262">
                <choiceState section="sect193" set="disabled" />
            </test>
        </section>

        <section id="sect132">
            <test not="true" hasObject="fireseed">
                <choiceState section="sect15" set="disabled" />
            </test>
            <choiceSelected section="sect15">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect134">
            <death />
        </section>

        <section id="sect135">
            <test not="true" hasObject="pass">
                <choiceState section="sect68" set="disabled" />
            </test>
        </section>

        <section id="sect136">
            <test not="true" hasDiscipline="pthmnshp">
                <choiceState section="sect256" set="disabled" />
            </test>
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect342" set="disabled" />
            </test>
        </section>

        <section id="sect138">
            <tag id="danarg" />
            <choiceState section="sect203" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect203" set="enabled" />
                    <choiceState section="sect36" set="disabled" />
                    <choiceState section="sect300" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect139">
            <pick objectId="greycrystalring" />
            <sell class="special" except="greycrystalring" price="8" />

            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test hasObject="greycrystalring">
                    <choiceState section="all" set="enabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect141">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 59">
                    <goToSection section="sect59" />
                </test>
                <test expression="[NUMBERPICKER] != 59">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect143">
            <test not="true" hasObject="pass">
                <choiceState section="sect18" set="disabled" />
            </test>
        </section>

        <section id="sect145">
            <pick class="money" count="-4" />
        </section>

        <section id="sect146">
            <endurance count="-5" />
        </section>

        <section id="sect150">
            <meal />
        </section>

        <section id="sect152">
            <meal />
        </section>

        <section id="sect154">
            <death />
        </section>

        <section id="sect155">
            <choiceState section="all" set="disabled" />
            <test not="true" hasDiscipline="curing">
                <combat enemyMultiplier="2" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 4">
                <combat enemyMultiplier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect156">
            <endurance count="-6" />
            <registerGlobalRule id="book8sect156">
                <objectUsed objectId="tinctureoxydine|oedeherb">
                    <!-- 
                        There is a problem with this: If you use the "tinctureoxydine|oedeherb" on THIS section, on the action chart,
                        when you return to the section, the book8sect156 is re-registered, because the "sect156" section was reset...
                        Instead this, on sect31 we will check if "book8sect156" is still registered
                    -->
                    <!--resetSectionState sectionId="sect156" /-->
                    <unregisterGlobalRule id="book8sect156" />
                    <toast text="Your wound has been healed!" />
                </objectUsed>
            </registerGlobalRule>
        </section>

        <section id="sect157">
            <choiceState section="sect67" set="disabled" />
            <test hasDiscipline="invsblty">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect67" set="enabled" />
                    <choiceState section="sect96" set="disabled" />
                    <choiceState section="sect198" set="disabled" />
                    <choiceState section="sect305" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect158">
            <death />
        </section>

        <section id="sect159">
            <choiceState section="all" set="disabled" />
            <endurance count="-5" />
            <combat noMindblast="true" noPsiSurge="true" enemyMultiplier="0.5" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect161">
            <test canUseBow="false">
                <choiceState section="sect208" set="disabled" />
            </test>
            <choiceSelected section="sect208">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect162">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <combat combatSkillModifier="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect163">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect341" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect122" set="disabled" />
            </test>
        </section>

        <section id="sect164">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect165">
            <death />
        </section>

        <section id="sect168">
            <object objectId="arrow" count="2" price="1" unlimited="true" />
            <object objectId="bow" price="8" unlimited="true" />
            <object objectId="quiver" price="3" unlimited="true" />
            <object objectId="wristandfingerguard" price="2" unlimited="true" />
            <object objectId="woodbowcase" price="5" unlimited="true" />
            <object objectId="leatherbowcase" price="3" unlimited="true" />
            <object objectId="bowstring" price="1" unlimited="true" />
            <test not="true" hasObject="silverbowduadon">
                <choiceState section="sect304" set="disabled" />
            </test>
            <test hasObject="silverbowduadon">
                <choiceState section="sect264" set="disabled" />
            </test>
        </section>

        <section id="sect169">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noWeapon="true" mindforceCS="-2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect170">
            <meal />
        </section>

        <section id="sect174">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect93" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect128" set="disabled" />
            </test>
        </section>

        <section id="sect175">
            <meal />
        </section>

        <section id="sect176">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect115" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect334" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect178">
            <drop objectId="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb" />
        </section>

        <section id="sect183">
            <choiceState section="all" set="disabled" />

            <pick objectId="paidosword" />
            <currentWeapon objectId="paidosword" />
            <message id="msg-drop-weapon" text="You must use the Paido sword as current weapon on this combat" />
            <onInventoryEvent>
                <disableCombats />
                <test currentWeapon="paidosword">
                    <disableCombats disabled="false" />
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" mindforceEP="-2" enemyImmuneTurns="1" />
            <test hasCircle="circleSpirit">
                <combat combatSkillModifier="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect184">
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect345" set="disabled" />
            </test>
            <test hasDiscipline="nexus">
                <choiceState section="sect159" set="disabled" />
            </test>
        </section>

        <section id="sect187">
            <!-- Complex. Let the player choose (TODO: This could be improved, checking the dropped weapon type) -->
            <message id="msg-drop-weapon" text="Drop a non-edged weapon before continuing (i.e. a Mace, Warhammer, Quarterstaff, or Bow)" />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect188">
            <test not="true" expression="[MONEY] >= 4">
                <choiceState section="sect145" set="disabled" />
            </test>
        </section>

        <section id="sect189">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect287" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect13" set="disabled" />
            </test>
        </section>

        <section id="sect190">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect146" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 4">
                <choiceState section="sect146" set="disabled" />
            </test>
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect222" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect191">
            <pick objectId="vialofclearliquid" />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test hasObject="vialofclearliquid">
                    <test hasDiscipline="dvnation|pthmnshp">
                        <choiceState section="sect114" set="enabled" />
                    </test>
                    <test not="true" hasDiscipline="dvnation|pthmnshp">
                        <choiceState section="sect340" set="enabled" />
                        <choiceState section="sect157" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect194">
            <choiceState section="sect283" set="disabled" />
            <test hasObject="lantern|firesphere">
                <choiceState section="sect283" set="enabled" />
                <choiceState section="sect118" set="disabled" />
            </test>
            <test hasObject="torch">
                <test hasObject="tinderbox">
                    <choiceState section="sect283" set="enabled" />
                    <choiceState section="sect118" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect195">
            <test canUseBow="false">
                <choiceState section="sect323" set="disabled" />
            </test>
            <choiceSelected section="sect323">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect198">
            <test not="true" hasDiscipline="anmlctrl">
                <choiceState section="sect279" set="disabled" />
            </test>
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect241" set="disabled" />
            </test>
        </section>

        <section id="sect199">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" enemyMultiplier="0.5" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect200">
            <death />
        </section>

        <section id="sect201">
            <object objectId="sword" />
            <object objectId="bow" />
            <object objectId="arrow" count="3" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect202">
            <choiceState section="all" set="disabled" />
            <pick objectId="lodestone" />
            <onInventoryEvent>
                <test hasObject="lodestone">
                    <choiceState section="all" set="enabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect204">
            <choiceState section="sect327" set="disabled" />
            <test not="true" hasObject="mapoftharro">
                <choiceState section="sect22" set="disabled" />
            </test>
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect327" set="enabled" />
                <choiceState section="sect14" set="disabled" />
                <choiceState section="sect78" set="disabled" />
            </test>
        </section>

        <section id="sect205">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" />
            <afterCombats>
                <choiceState section="sect9" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect309" set="enabled" />
            </afterElude>
        </section>

        <section id="sect206">
            <test canUseBow="false">
                <choiceState section="sect246" set="disabled" />
            </test>
        </section>

        <section id="sect209">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect162" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect303" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlctrl">
                <randomTableIncrement increment="+3" />
            </test>
            <randomTableIncrement increment="[BOWBONUS]" />
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect212">
            <test canUseBow="false">
                <choiceState section="sect17" set="disabled" />
            </test>
        </section>

        <section id="sect214">
            <!-- OK, this is tricky.  We want to care about the weapon the player entered this section with -->
            <!-- Yes, it is. Let the player choose if he/she can. Ignore current weapon (bow cannot set as current weapon),
                 and check all player weapons -->
            <!-- edged weapons -->
            <test not="true" hasWeaponType="sword|dagger|axe|spear|shortsword|broadsword">
                <choiceState section="sect235" set="disabled" />
            </test>
            <!-- non-edged weapons -->
            <test not="true" hasWeaponType="mace|warhammer|quarterstaff|bow">
                <choiceState section="sect187" set="disabled" />
            </test>
        </section>

        <section id="sect216">
            <choiceState section="sect142" set="disabled" />
            <test hasDiscipline="dvnation">
                <choiceState section="sect142" set="enabled" />
                <choiceState section="sect21" set="disabled" />
                <choiceState section="sect175" set="disabled" />
            </test>
        </section>

        <section id="sect217">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect93" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect128" set="disabled" />
            </test>
        </section>

        <section id="sect222">
            <death />
        </section>

        <section id="sect223">
            <death />
        </section>

        <section id="sect226">
            <endurance count="-3" />
            <meal />
        </section>

        <section id="sect228">
            <object objectId="larnumaliqueur2" />
        </section>

        <section id="sect230">
            <endurance count="-8" />
        </section>

        <section id="sect231">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect233">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect237">
            <death />
        </section>

        <section id="sect238">
            <test not="true" hasDiscipline="psiscrn">
                <choiceState section="sect186" set="disabled" />
            </test>
            <test hasDiscipline="psiscrn">
                <choiceState section="sect230" set="disabled" />
            </test>
        </section>

        <section id="sect241">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect242">
            <object objectId="greycrystalring" />
            <message id="msg-drop-weapon" text="Drop a Lodestone, a Jewelled Mace, a Silver Helm or the Grey Crystal Ring before continuing" />
            <onInventoryEvent>
                <test objectOnSection="greycrystalring|lodestone|jewelledmace|silverhelm">
                    <message id="msg-drop-weapon" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" objectOnSection="greycrystalring|lodestone|jewelledmace|silverhelm">
                    <message id="msg-drop-weapon" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect244">
            <test not="true" expression="[MONEY] >= 20">
                <choiceState section="sect20" set="disabled" />
            </test>
            <choiceSelected section="sect20">
                <pick class="money" count="-20" />
            </choiceSelected>
        </section>

        <section id="sect246">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect184" set="enabled" />
                </case>
                <case from="5" to="7">
                    <choiceState section="sect4" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect213" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect248">
            <test canUseBow="false">
                <choiceState section="sect39" set="disabled" />
            </test>
            <choiceSelected section="sect39">
                <pick class="arrow" count="-1" />
            </choiceSelected>
            <onInventoryEvent>
                <test not="true" expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] > 0">
                    <choiceState section="sect258" set="disabled" />
                </test>
                <test expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] > 0">
                    <choiceState section="sect258" set="enabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect249">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect76" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect221" set="disabled" />
            </test>
        </section>

        <section id="sect251">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="1" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect252">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect257">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombatTurn turn="2">
                <test combatsWon="false">
                    <disableCombats />
                    <choiceState section="sect163" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <test combatsWon="true">
                    <choiceState section="sect12" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect258">
            <endurance count="-8" />
            <message id="msg-drop-weapon" text="Drop a weapon before continuing" />
            <onInventoryEvent>
                <choiceState section="all" set="disabled" />
                <test expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="hide" />
                    <choiceState section="sect27" set="enabled" />
                    <test expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] > 0">
                        <choiceState section="sect75" set="enabled" />
                    </test>
                </test>
                <test not="true" expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect260">
            <test not="true" expression="[MEALS] > 0">
                <choiceState section="sect34" set="disabled" />
            </test>
            <test not="true" hasDiscipline="psisurge">
                <choiceState section="sect250" set="disabled" />
            </test>
            <test expression="[MEALS] > 0" hasDiscipline="psisurge">
                <choiceState section="sect5" set="disabled" />
            </test>
        </section>

        <section id="sect261">
            <test not="true" hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect349" set="disabled" />
            </test>
            <test hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect121" set="disabled" />
            </test>
        </section>

        <section id="sect263">
            <death />
        </section>

        <section id="sect265">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect268">
            <!--
            laumspurmeal: 3
            laumspurpotion3: 3 + meal
            laumspurpotion4: 4
            laumspurpotion: 5
            redpotionlaumspur: 5
            rendalimelixir: 6
            laumspurpotion8: 8
            oedeherb: 10
            sorted: laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb
        -->
            <test not="true" hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect178" set="disabled" />
            </test>
            <test hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect281" set="disabled" />
            </test>
        </section>

        <section id="sect269">
            <executeOnce>
                <!-- Order of rules is important here -->
                <test expression="[SPECIAL-ITEMS-ON-ACTIONCHART] == 0">
                    <drop backpackItemSlots="1" />
                </test>
                <test not="true" expression="[SPECIAL-ITEMS-ON-ACTIONCHART] >= 4">
                    <drop specialItemSlots="last" />
                </test>
                <test expression="[SPECIAL-ITEMS-ON-ACTIONCHART] >= 4">
                    <drop specialItemSlots="4" />
                </test>
            </executeOnce>
        </section>

        <section id="sect272">
            <test canUseBow="false">
                <choiceState section="sect28" set="disabled" />
            </test>
            <test not="true" hasObject="fireseed">
                <choiceState section="sect207" set="disabled" />
            </test>
            <choiceSelected section="sect207">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect274">
            <endurance count="+3" />
        </section>

        <section id="sect275">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect8" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect101" set="disabled" />
            </test>
        </section>

        <section id="sect276">
            <choiceState section="sect227" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect227" set="enabled" />
                    <choiceState section="sect127" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect281">
            <death />
        </section>

        <section id="sect284">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect302" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect119" set="enabled" />
                </case>
            </randomTable>
            <test expression="[KAILEVEL] >= 4">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect287">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceCS="-2" index="0" />
            <combat noMindblast="true" mindforceCS="-2" index="1" />
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" index="0" />
                <combat damageMultiplier="2" index="1" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect288">
            <choiceState section="sect156" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect156" set="enabled" />
                    <choiceState section="sect322" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect290">
            <choiceState section="sect97" set="disabled" />
            <test hasWeaponType="dagger">
                <choiceState section="sect97" set="enabled" />
                <choiceState section="sect132" set="disabled" />
            </test>
        </section>

        <section id="sect291">
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect345" set="disabled" />
            </test>
            <test hasDiscipline="nexus">
                <choiceState section="sect159" set="disabled" />
            </test>
        </section>

        <section id="sect294">
            <test expression="[MEALS] > 0">
                <drop objectId="meal" />
            </test>
        </section>

        <section id="sect295">
            <death />
        </section>

        <section id="sect296">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect69" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect140" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 4">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect298">
            <choiceState section="all" set="disabled" />
            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-3" />
                <afterCombatTurn turn="2">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect299">
            <test not="true" expression="[MONEY] >= 10">
                <choiceState section="sect266" set="disabled" />
            </test>
            <choiceSelected section="sect266">
                <pick class="money" count="-10" />
            </choiceSelected>
        </section>

        <section id="sect300">
            <choiceState section="sect326" set="disabled" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect326" set="enabled" />
                    <choiceState section="sect105" set="disabled" />
                    <choiceState section="sect123" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect301">
            <choiceState section="sect148" set="disabled" />
            <test hasDiscipline="hntmstry">
                <choiceState section="sect148" set="enabled" />
                <choiceState section="sect290" set="disabled" />
                <choiceState section="sect177" set="disabled" />
            </test>
        </section>

        <section id="sect305">
            <test canUseBow="false">
                <choiceState section="sect164" set="disabled" />
            </test>
            <test not="true" expression="[ARROWS] >= 2">
                <choiceState section="sect164" set="disabled" />
            </test>
            <choiceSelected section="sect164">
                <pick class="arrow" count="-2" />
            </choiceSelected>

            <choiceState section="sect231" set="disabled" />
            <afterCombats>
                <choiceState section="sect231" set="enabled" />
                <choiceState section="sect164" set="disabled" />
            </afterCombats>
        </section>

        <section id="sect306">
            <object objectId="mapoftharro" />
            <object objectId="meal" />
            <object objectId="axe" />
        </section>

        <section id="sect307">
            <choiceState section="sect45" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect45" set="enabled" />
                    <choiceState section="sect155" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect308">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceEP="-2" />
            <test hasCircle="circleSpirit">
                <combat combatSkillModifier="+2" />
            </test>
            <test currentWeapon="sommerswerd">
                <combat damageMultiplier="2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect310">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="8">
                    <choiceState section="sect184" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect213" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect312">
            <object objectId="giakscroll2" />
        </section>

        <section id="sect313">
            <choiceState section="all" set="disabled" />
            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-4" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect315">
            <test not="true" hasDiscipline="psiscrn">
                <choiceState section="sect74" set="disabled" />
            </test>
            <test hasDiscipline="psiscrn">
                <choiceState section="sect223" set="disabled" />
            </test>
        </section>

        <section id="sect316">
            <test not="true" expression="[MONEY] >= 30">
                <choiceState section="sect139" set="disabled" />
            </test>
            <test expression="[MONEY] >= 30">
                <choiceState section="sect242" set="disabled" />
            </test>
            <choiceSelected section="sect139">
                <pick class="money" count="-30" />
            </choiceSelected>
        </section>

        <section id="sect317">
            <test not="true" hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect331" set="disabled" />
            </test>
            <test hasObject="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb">
                <choiceState section="sect295" set="disabled" />
            </test>
        </section>

        <section id="sect321">
            <object objectId="sackofsilver" unlimited="true" />
        </section>

        <section id="sect322">
            <death />
        </section>

        <section id="sect323">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="2" noMindblast="true" eludeTurn="3" />
            <afterElude>
                <choiceState section="sect191" set="enabled" />
            </afterElude>
            <afterCombats>
                <choiceState section="sect293" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect325">
            <endurance count="-3" />
        </section>

        <section id="sect331">
            <drop objectId="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb" />
        </section>

        <section id="sect333">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceCS="-2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect336">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect343" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect190" set="disabled" />
            </test>
        </section>

        <section id="sect337">
            <endurance count="-3" />
        </section>

        <section id="sect338">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 7">
                    <goToSection section="sect7" />
                </test>
                <test expression="[NUMBERPICKER] != 7">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect339">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" eludeTurn="3" />

            <combat combatSkillModifier="-8" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 4">
                    <combat combatSkillModifier="0" />
                </test>
            </test>

            <afterElude>
                <choiceState section="sect48" set="enabled" />
            </afterElude>
            <afterCombats>
                <choiceState section="sect344" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect340">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect320" set="disabled" />
            </test>
            <test hasDiscipline="curing">
                <choiceState section="sect261" set="disabled" />
            </test>
        </section>

        <section id="sect341">
            <test canUseBow="false">
                <choiceState section="sect215" set="disabled" />
            </test>
            <choiceSelected section="sect215">
                <pick class="arrow" count="-1" />
            </choiceSelected>

            <test not="true" hasObject="fireseed">
                <choiceState section="sect33" set="disabled" />
            </test>
            <choiceSelected section="sect33">
                <drop objectId="fireseed"/>
            </choiceSelected>
        </section>

        <section id="sect344">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect142" set="disabled" />
            </test>
        </section>

        <section id="sect346">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" />
            <afterElude>
                <choiceState section="sect309" set="enabled" />
            </afterElude>
            <afterCombats>
                <choiceState section="sect9" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect348">
            <test not="true" hasObject="lodestone">
                <choiceState section="sect29" set="disabled" />
            </test>
            <test hasObject="lodestone">
                <choiceState section="sect170" set="disabled" />
            </test>
        </section>

        <section id="sect349">
            <drop objectId="laumspurpotion3|laumspurmeal|laumspurpotion4|laumspurpotion|redpotionlaumspur|rendalimelixir|laumspurpotion8|oedeherb" />
        </section>

        <section id="sect350">
            <test sectionVisited="sect71">
                <combatSkill count="+2" toast="false" />
            </test>
        </section>

    </sections>

</mechanics>