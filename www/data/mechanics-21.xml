<?xml version="1.0" encoding="utf-8"?>

<mechanics book="21" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/www/data/mechanics.xsd">

    <!-- GAME RULES -->
    <sections>
        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Restore Deliverance use each X days -->
            <restoreDeliveranceUse />
            <!-- Reset Curing EP Used counter-->
            <resetNewOrderCuringEPRestoredUse />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="kainame">
            <!-- Select the player Kai name UI -->
            <setKaiName />
        </section>
        
        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="5">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map">
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack">
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 20" excessToKaiMonastry="true" />
            </randomTable>

            <object objectId="quarterstaff" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="flute" />
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="axe" />

            <randomTable index="1">
                <case value="0">
                    <pick objectId="spawnsmite"/>
                </case>
                <case value="1">
                    <pick objectId="alema"/>
                </case>
                <case value="2">
                    <pick objectId="magnara"/>
                </case>
                <case value="3">
                    <pick objectId="sunstrike"/>
                </case>
                <case value="4">
                    <pick objectId="kaistar"/>
                </case>
                <case value="5">
                    <pick objectId="valiance"/>
                </case>
                <case value="6">
                    <pick objectId="ulnarias"/>
                </case>
                <case value="7">
                    <pick objectId="raumas"/>
                </case>
                <case value="8">
                    <pick objectId="illuminatus"/>
                </case>
                <case value="9">
                    <pick objectId="firefall"/>
                </case>
            </randomTable>

            <chooseEquipment text="Click on the Random Table links to get money and a Kai Weapon before continuing" />

            <message text="You may take up to five of the following (all meals count as one object):" />
        </section>

        <section id="sect1">
            <pick objectId="moonstone" />
        </section>

        <section id="sect5">
            <choiceState section="all" set="disabled" />

            <combat noWeapon="true" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombatTurn turn="1">
                <combat noWeapon="false" />
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect7">
            <choiceState section="sect221" set="disabled" />
            <test not="true" sectionVisited="sect79">
                <object objectId="laumspurpotion4" price="3" />
                <object objectId="potionofstrength" price="3" />
                <object objectId="mustowpotion" price="3" />
                <object objectId="sebarispotion" price="3" />
            </test>
            <test sectionVisited="sect79">
                <object objectId="laumspurpotion4" price="2" />
                <object objectId="potionofstrength" price="2" />
                <object objectId="mustowpotion" price="2" />
                <object objectId="sebarispotion" price="2" />
            </test>
            <onInventoryEvent>
                <test pickedSomethingOnSection="sect7">
                    <choiceState section="sect221" set="enabled" />
                    <choiceState section="sect79" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect8">
            <endurance count="3" />
        </section>

        <section id="sect9">
            <endurance count="-1" />
        </section>

        <section id="sect10">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect12">
            <endurance count="-2" />
        </section>

        <section id="sect13">
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect303" set="disabled" />
            </test>
            <test not="true" hasDiscipline="element">
                <choiceState section="sect210" set="disabled" />
            </test>
        </section>

        <section id="sect14">
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect98" set="disabled" />
            </test>
        </section>

        <section id="sect15">
            <endurance count="-6" />
        </section>

        <section id="sect16">
            <death />
        </section>

        <section id="sect17">
            <pick class="money" count="-3" />
        </section>

        <section id="sect18">
            <death />
        </section>

        <section id="sect21">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombats>
                <choiceState section="sect97" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect13" set="enabled" />
            </afterElude>
        </section>
        
        <section id="sect22">
            <endurance count="-2" />
        </section>

        <section id="sect23">
            <pick class="money" count="10" />
            <meal />
        </section>

        <section id="sect24">
            <test not="true" expression="[MONEY] >= 1">
                <choiceState section="sect219" set="disabled" />
            </test>
        </section>

        <section id="sect26">
            <endurance count="-8" />
        </section>

        <section id="sect27">
            <endurance count="-1" />
            <choiceState section="sect158" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect158" set="enabled" />
                <choiceState section="sect247" set="disabled" />
            </test>
        </section>

        <section id="sect28">
            <endurance count="3" />
        </section>

        <section id="sect29">
            <endurance count="-3" />
        </section>

        <section id="sect30">
            <pick class="money" count="1" />
            <drop backpackItemSlots="1" />
        </section>

        <section id="sect31">
            <combat />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect289" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect195" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect33">
            <drop objectId="allweapons" />
        </section>

        <section id="sect34">
            <test expression="([MONEY]) &lt; 4">
                <choiceState section="sect138" set="disabled" />
            </test>
            <test expression="([MONEY]) &lt; 2">
                <choiceState section="all" set="disabled" />
                <message id="msg-drop-object" text="Drop one item of your choice to pay for a Standard room before continuing" />

                <onInventoryEvent>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] > 0 || [WEAPON-ITEMS-CNT-ON-SECTION] > 0 || [SPECIAL-ITEMS-ON-SECTION] > 0">
                        <message id="msg-drop-object" op="hide" />
                        <choiceState section="sect216" set="enabled" />
                    </test>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 0 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] == 0 &amp;&amp; [SPECIAL-ITEMS-ON-SECTION] == 0">
                        <message id="msg-drop-object" op="show" />
                        <choiceState section="sect216" set="disabled" />
                    </test>
                </onInventoryEvent>
            </test>
        </section>

        <section id="sect36">
            <endurance count="-3" />
        </section>

        <section id="sect37">
            <choiceState section="sect272" set="disabled" />

            <test hasDiscipline="bardsman">
                <test hasObject="flute|lyre">
                    <choiceState section="sect272" set="enabled" />
                    <choiceState section="sect8" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect40">
            <!-- TODO: Would be cool to add a timer here for the player to start the countdown -->
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 23">
                    <goToSection section="sect23" />
                </test>
                <test expression="[NUMBERPICKER] != 23">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect42">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect67" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect205" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect43">
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
        </section>

        <section id="sect44">
            <combat combatSkillModifier="+3" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombatTurn turn="2">
                <combat combatSkillModifier="+0" />
            </afterCombatTurn>
        </section>

        <section id="sect46">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect135" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect4" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="3" />
            </test>
        </section>

        <section id="sect48">
            <choiceState section="sect199" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect199" set="enabled" />
                <choiceState section="sect239" set="disabled" />
            </test>
        </section>

        <section id="sect49">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect50">
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" noKaiBlast="true" noKaiRay="true" />
        </section>

        <section id="sect51">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="1">
                    <choiceState section="sect342" set="enabled" />
                </case>
                <case from="2" to="7">
                    <choiceState section="sect15" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect203" set="enabled" />
                </case>
            </randomTable>

            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="3" />
            </test>
            <choiceState section="all" set="disabled" />
            <numberPicker 
            text="Choose the number of Endurance Points you are prepared to deduct"
            min="0" 
            actionButton="Choose"
            />
            <numberPickerChoosed executeAtStart="true">
                <numberPicker enabled="false" />
                <endurance count="-[NUMBERPICKER]" />
                <choiceState section="all" set="disabled" />

                <randomTableIncrement increment="[NUMBERPICKER]" />
                <test expression="[RANDOM] + [NUMBERPICKER] &lt;= 1">
                    <choiceState section="sect342" set="enabled" />
                </test>
                <test expression="[RANDOM] + [NUMBERPICKER] >= 2 &amp;&amp; [RANDOM] + [NUMBERPICKER] &lt;= 7">
                    <choiceState section="sect15" set="enabled" />
                </test>
                <test expression="[RANDOM] + [NUMBERPICKER] >= 8">
                    <choiceState section="sect203" set="enabled" />
                </test>           
            </numberPickerChoosed>
        </section>

        <section id="sect52">
            <endurance count="3" />
        </section>

        <section id="sect53">
            <choiceState section="sect107" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect115" set="disabled" />
            </test>
        </section>

        <section id="sect54">
            <choiceState section="all" set="disabled" />
            <test hasObject="ironskull">
                <choiceState section="sect201" set="enabled" />
            </test>
            <test hasObject="siyencrown">
                <choiceState section="sect134" set="enabled" />
            </test>
            <test hasObject="kutyanemerald">
                <choiceState section="sect298" set="enabled" />
            </test>
       </section>

        <section id="sect55">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="1">
                    <choiceState section="sect16" set="enabled" />
                </case>
                <case from="2">
                    <choiceState section="sect294" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect56">
            <drop backpackItemSlots="1" />
        </section>

        <section id="sect57">
            <endurance count="-5" />
        </section>

        <section id="sect58">
            <onInventoryEvent>
                <test expression="([BACKPACK-ITEMS-CNT-ON-SECTION] - [MEALS-CNT-ON-SECTION]) >= 2">
                    <choiceState section="sect333" set="enabled" />
                </test>
                <test not="true" expression="([BACKPACK-ITEMS-CNT-ON-SECTION] - [MEALS-CNT-ON-SECTION]) >= 2">
                    <choiceState section="sect333" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect59">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect60">
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
        </section>

        <section id="sect62">
            <object objectId="rope" price="3" />
            <object objectId="blanket" price="2" />
            <object objectId="hourglass" price="3" />
            <object objectId="tinderbox" price="2" />
            <object objectId="spyglass" price="2" />
        </section>

        <section id="sect65">
            <choiceState section="sect317" set="disabled" />
            <test hasDiscipline="herbmst">
                <choiceState section="sect317" set="enabled" />
                <choiceState section="sect228" set="disabled" />
            </test>
        </section>

        <section id="sect66">
            <choiceState section="sect229" set="disabled" />
            <choiceState section="sect339" set="disabled" />
            <test hasDiscipline="gnosis">
                <choiceState section="sect229" set="enabled" />
            </test>
            <test hasDiscipline="hntmstry">
                <choiceState section="sect339" set="enabled" />
            </test>
        </section>

        <section id="sect67">
            <choiceState section="sect226" set="disabled" />
            <test hasDiscipline="element">
                <choiceState section="sect226" set="enabled" />
                <choiceState section="sect55" set="disabled" />
            </test>
        </section>

        <section id="sect68">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect141" set="enabled" />
            </test>
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect168" set="enabled" />
            </test>
            <test canUseBow="true">
                <choiceState section="sect326" set="enabled" />
            </test>  
            <choiceState section="sect53" set="enabled" />      
        </section>

        <section id="sect70">
            <endurance count="-10" />
        </section>

        <section id="sect71">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect72">
            <test canUseBow="false">
                <choiceState section="sect345" set="disabled" />
            </test>  
        </section>

        <section id="sect75">
            <test canUseBow="false">
                <choiceState section="sect101" set="disabled" />
            </test>  
        </section>

        <section id="sect77">
            <test expression="([MONEY]) >= 7">
                <choiceState section="sect253" set="enabled" />
                <choiceState section="sect164" set="disabled" />
            </test>
            <test not="true" expression="([MONEY]) >= 7">
                <choiceState section="sect253" set="disabled" />
                <choiceState section="sect164" set="enabled" />
            </test>
        </section>

        <section id="sect78">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="magi">
                <choiceState section="sect192" set="enabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect257" set="enabled" />
            </test>
            <test hasDiscipline="element">
                <choiceState section="sect308" set="enabled" />
            </test>
            <choiceState section="sect292" set="enabled" />
        </section>

        <section id="sect79">
            <resetSectionState sectionId="sect7" />
        </section>

        <section id="sect80">
            <test hasObject="cowana">
                <choiceState section="sect243" set="enabled" />
                <choiceState section="sect225" set="disabled" />
            </test>
            <test not="true" hasObject="cowana">
                <choiceState section="sect243" set="disabled" />
                <choiceState section="sect225" set="enabled" />
            </test>
        </section>

        <section id="sect81">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect82">
            <saveInventoryState restorePoint="book21sect82BowConfiscated" objectsType="bow" />
            <drop objectId="bow" />
        </section>

        <section id="sect83">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect30" set="enabled" />
            </test>
            <test hasDiscipline="bardsman">
                <choiceState section="sect286" set="enabled" />
            </test>
            <choiceState section="sect318" set="enabled" />
        </section>

        <section id="sect84">
            <endurance count="-2" />
        </section>

        <section id="sect87">
            <test hasDiscipline="alchemy">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect115" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect107" set="disabled" />
                <choiceState section="sect115" set="enabled" />
            </test>
        </section>

        <section id="sect89">
            <test hasObject="ironskull">
                <choiceState section="sect237" set="enabled" />
                <choiceState section="sect332" set="disabled" />
            </test>
            <test not="true" hasObject="ironskull">
                <choiceState section="sect237" set="disabled" />
                <choiceState section="sect332" set="enabled" />
            </test>
        </section>

        <section id="sect91">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="3">
                    <choiceState section="sect304" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect193" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect92">
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect153" set="enabled" />
                <choiceState section="sect280" set="disabled" />
            </test>
            <test not="true" hasDiscipline="anmlmstr">
                <choiceState section="sect153" set="disabled" />
                <choiceState section="sect280" set="enabled" />
            </test>
        </section>

        <section id="sect94">
            <choiceState section="all" set="disabled" />

            <combat immuneTurns="1" noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="sect41" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect95">
            <test expression="([MONEY]) &lt; 1">
                <choiceState section="sect69" set="disabled" />
            </test>
            <choiceSelected section="sect69">
                <pick class="money" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect96">
            <test expression="([MONEY]) &lt; 3">
                <choiceState section="sect183" set="disabled" />
            </test>
        </section>

        <section id="sect97">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="magi">
                <choiceState section="sect303" set="enabled" />
            </test>
            <test hasDiscipline="element">
                <choiceState section="sect210" set="enabled" />
            </test>
            <choiceState section="sect162" set="enabled" />
        </section>

        <section id="sect98">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="4">
                    <choiceState section="sect57" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect312" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="2" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-2" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect99">
            <meal />
        </section>

        <section id="sect102">
            <pick objectId="temujunsring" />
        </section>

        <section id="sect103">
            <message id="msg-drop-object" text="Drop Special Items of your choice to restore Endurance points" />
            <onInventoryEvent>
                <test objectOnSection="moonstone|ironskull">
                    <choiceState section="all" set="disabled" />
                </test>
                <test not="true" objectOnSection="moonstone|ironskull">
                    <choiceState section="all" set="enabled" />
                </test>
            </onInventoryEvent>
            <choiceSelected section="sect34">
                <endurance count="[SPECIAL-ITEMS-ON-SECTION] * 6" />
            </choiceSelected>
        </section>

        <section id="sect104">
            <meal />
        </section>

        <section id="sect108">
            <object objectId="ironskull" />
        </section>

        <section id="sect109">
            <endurance count="-3" />
            <meal />
        </section>

        <section id="sect111">
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect98" set="disabled" />
            </test>
        </section>

        <section id="sect112">
            <endurance count="-3" />
        </section>

        <section id="sect117">
            <object objectId="siyencrown" />
        </section>

        <section id="sect119">
            <choiceState section="sect288" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test hasDiscipline="gnosis">
                    <choiceState section="sect288" set="enabled" />
                    <choiceState section="sect129" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect120">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect121">
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect303" set="disabled" />
            </test>
            <test not="true" hasDiscipline="element">
                <choiceState section="sect210" set="disabled" />
            </test>
        </section>

        <section id="sect122">
            <endurance count="-2" />
        </section>
 
        <section id="sect125">
            <choiceState section="sect215" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect215" set="enabled" />
                <choiceState section="sect130" set="disabled" />
            </test>
        </section>

        <section id="sect126">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="2">
                    <choiceState section="sect238" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect84" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect284" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="3" />
            </test>
            <test expression="[ENDURANCE] &lt;= 20">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect127">
            <pick class="money" count="-2" />
        </section>

        <section id="sect129">
            <choiceState section="sect197" set="disabled" />
            <test hasDiscipline="element">
                <choiceState section="sect197" set="enabled" />
                <choiceState section="sect51" set="disabled" />
            </test>
        </section>

        <section id="sect132">
            <object objectId="sword" />
            <object objectId="dagger" />
            <pick class="money" count="20" />
            <endurance count="3" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect134">
            <sell class="special" price="20" objectId="siyencrown" />
            <sell class="special" price="10" objectId="ironskull" />
            <sell class="special" price="30" objectId="kutyanemerald" />
        </section>

        <section id="sect135">
            <choiceState section="sect334" set="disabled" />
            <afterCombats>
                <choiceState section="sect334" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect136">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="4">
                    <choiceState section="sect320" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect296" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
            <test expression="[ENDURANCE] &lt;= 15">
                <randomTableIncrement increment="-1" />
            </test>
        </section>
        
        <section id="137">
            <meal />
        </section>

        <section id="sect138">
            <pick class="money" count="-4" />
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="4">
                    <choiceState section="sect330" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect92" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect142">
            <!-- TODO: The three candles are purchased as one, should probably be a stack in the backpack -->
            <object objectId="dagger" price="1" />
            <object objectId="scentedoil" price="1" />
            <object objectId="candle" price="1" count="3" />
            <object objectId="slippers" price="1" />
            <object objectId="coppercup" price="1" />
            <object objectId="rope" price="1" />
            <object objectId="lantern" price="1" />
            <object objectId="lyre" price="1" />
            <object objectId="ballofchalk" price="1" />
            <object objectId="arrow" price="1" count="3" />
        </section>

        <section id="sect143">
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] >= 2 || [WEAPON-ITEMS-CNT-ON-SECTION] > 0 || [SPECIAL-ITEMS-ON-SECTION] > 0">
                    <choiceState section="all" set="enabled" />

                </test>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] &lt; 2 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] == 0 &amp;&amp; [SPECIAL-ITEMS-ON-SECTION] == 0">
                    <choiceState section="all" set="disabled" />

                </test>
            </onInventoryEvent>
        </section>

        <section id="sect144">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="3">
                    <choiceState section="sect335" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect27" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect190" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect149">
            <pick class="money" count="2" />
        </section>

        <section id="sect150">
            <choiceState section="sect133" set="disabled" />
            <test hasDiscipline="astrolgy">
                <choiceState section="sect133" set="enabled" />
                <choiceState section="sect327" set="disabled" />
            </test>
        </section>

        <section id="sect151">
            <object objectId="broadsword" price="8" />
            <object objectId="warhammer" price="7" />
            <object objectId="dagger" price="3" />
            <object objectId="axe" price="8" />
            <object objectId="shortsword" price="4" />
            <object objectId="arrow" price="1" unlimited="true" />
        </section>

        <section id="sect152">
            <test not="true" expression="[MONEY] >= 20">
                <choiceState section="sect37" set="disabled" />
            </test>
            <choiceSelected section="sect37">
                <pick class="money" count="-20" />
            </choiceSelected>
        </section>

        <section id="sect153">
            <endurance count="-2" />
        </section>

        <section id="sect154">
            <pick class="arrow" count="-1" />
        </section>
        
        <section id="sect155">
            <onInventoryEvent>
                <test expression="[MONEY] >= 3">
                    <choiceState section="sect291" set="enabled" />
                    <choiceState section="sect214" set="disabled" />
                </test>
                <test expression="[MONEY] &lt; 3">
                    <choiceState section="sect291" set="disabled" />
                    <choiceState section="sect214" set="enabled" />
                </test>
            </onInventoryEvent>
            <sell class="special" except="moonstone" price="10" />
            <sell class="weapon" price="3" />
            <sell class="object" price="1" />
        </section>

        <section id="sect156">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="1">
                    <choiceState section="sect276" set="enabled" />
                </case>
                <case from="2" to="6">
                    <choiceState section="sect29" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect86" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlmstr">
                <randomTableIncrement increment="3" />
            </test>
        </section>

        <section id="sect157">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="4">
                    <choiceState section="sect218" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect307" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect159">
            <endurance count="2" />
        </section>

        <section id="sect160">
            <choiceState section="sect265" set="disabled" />
            <test hasDiscipline="deliver">
                <choiceState section="sect265" set="enabled" />
                <choiceState section="sect178" set="disabled" />
            </test>
        </section>

        <section id="sect162">
            <choiceState section="all" set="disabled" />

            <combat noMindblast="true" noKaiSurge="false" noPsiSurge="true" noKaiBlast="true" noKaiRay="true" combatSkillModifier="-3"/>
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect163">
            <endurance count="-8" />
        </section>

        <section id="sect164">
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] >= 2 || [WEAPON-ITEMS-CNT-ON-SECTION] >= 1">
                    <choiceState section="all" set="enabled" />
                </test>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] &lt; 2 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] &lt; 1">
                    <choiceState section="all" set="disabled" />
                </test>
                </onInventoryEvent>
        </section>

        <section id="sect165">
            <choiceState section="sect202" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect202" set="enabled" />
                <choiceState section="sect319" set="disabled" />
            </test>
        </section>

        <section id="sect166">
            <choiceState section="all" set="disabled" />
            <numberPicker 
                text="Choose the number of Gold Crowns you are going to donate"
                min="3" 
                money="true"
                actionButton="Choose"
            />
            <numberPickerChoosed executeAtStart="true">
                <numberPicker enabled="false" />
                <pick class="money" count="-[NUMBERPICKER]" />
                <test expression="[NUMBERPICKER] >= 3">
                    <choiceState section="sect89" set="enabled" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect168">
            <choiceState section="sect107" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect115" set="disabled" />
            </test>
        </section>

        <section id="sect170">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="7">
                    <choiceState section="sect348" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect59" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
        </section>

        <section id="sect172">
            <choiceState section="sect95" set="disabled" />
            <test expression="[MONEY] >= 6">
                <choiceState section="sect95" set="enabled" />
            </test>
            <choiceSelected section="sect95">
                <pick class="money" count="-6" />
            </choiceSelected>
        </section>

        <section id="sect173">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="5">
                    <choiceState section="sect231" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect80" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect174">
            <numberPicker text="Answer the riddle" min="1" max="350" actionButton="Choose" />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 125">
                    <goToSection section="sect125" />
                </test>
                <test expression="[NUMBERPICKER] != 125">
                    <toast text="Wrong number!" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect177">
            <choiceState section="sect72" set="disabled" />
            <test hasDiscipline="hntmstry|gnosis">
                <choiceState section="sect72" set="enabled" />
                <choiceState section="sect297" set="disabled" />
            </test>
        </section>

        <section id="sect179">
            <choiceState section="sect316" set="disabled" />
                <test hasDiscipline="hntmstry">
                    <test hasDiscipline="gnosis">
                    <choiceState section="sect316" set="enabled" />
                    <choiceState section="sect211" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect181">
            <choiceState section="sect267" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect267" set="enabled" />
                <choiceState section="sect325" set="disabled" />
            </test>
        </section>

        <section id="sect182">
            <numberPicker 
            text="Choose the number of Gold Crowns you would like to place"
            min="1" 
            money="true"
            actionButton="Choose"
            />
            <numberPickerChoosed executeAtStart="true">
                <numberPicker enabled="false" />
                <pick class="money" count="-[NUMBERPICKER]" />
                <endurance count="[NUMBERPICKER]" />
            </numberPickerChoosed>
        </section>

        <section id="sect183">
            <pick class="money" count="-3" />
        </section>

        <section id="sect184">
            <pick class="money" count="9" />
            <object objectId="dagger" />
        </section>

        <section id="sect185">
            <meal />
        </section>

        <section id="sect187">
            <choiceState section="sect123" set="disabled" />
            <choiceState section="sect47" set="disabled" />

            <test hasDiscipline="magi">
                <choiceState section="sect123" set="enabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect47" set="enabled" />
            </test>
        </section>

        <section id="sect188">
            <meal />
        </section>

        <section id="sect189">
            <endurance count="-2" />
            <test not="true" hasDiscipline="deliver">
                <choiceState section="sect169" set="disabled" />
            </test>
            <test hasDiscipline="deliver">
                <choiceState section="sect26" set="disabled" />
            </test>
        </section>

        <section id="sect190">
            <endurance count="-3" />
            <message id="msg-drop-object" text="Drop two items of your choice from your Backpack Items list before continuing" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] >= 2">
                    <message id="msg-drop-object" op="hide" />
                    <test hasDiscipline="alchemy">
                        <choiceState section="sect158" set="enabled" />
                        <choiceState section="sect247" set="disabled" />
                    </test>
                </test>
                <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] >= 2">
                    <message id="msg-drop-object" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect192">
            <choiceState section="all" set="disabled" />

            <combat combatSkillModifier="+2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombatTurn turn="1">
                <combat combatSkillModifier="+0" />
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect194">
            <choiceState section="sect22" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect22" set="enabled" />
                <choiceState section="sect173" set="disabled" />
            </test>
        </section>

        <section id="sect197">
            <choiceState section="all" set="disabled" />
            <numberPicker 
            text="Choose the number of Endurance Points you are prepared to deduct"
            min="0" 
            actionButton="Choose"
            />
            <numberPickerChoosed executeAtStart="true">
                <numberPicker enabled="false" />
                <endurance count="-[NUMBERPICKER]" />

                <randomTable>
                    <case to="2">
                        <choiceState section="sect70" set="enabled" />
                    </case>
                    <case from="3" to="6">
                        <choiceState section="sect246" set="enabled" />
                    </case>
                    <case from="7">
                        <choiceState section="sect305" set="enabled" />
                    </case>
                </randomTable>

                <randomTableIncrement increment="[NUMBERPICKER]" />
            </numberPickerChoosed>
        </section>

        <section id="sect200">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect3" set="enabled" />
            </test>
            <test hasDiscipline="element">
                <choiceState section="sect147" set="enabled" />
            </test>
            <test canUseBow="true">
                <choiceState section="sect10" set="enabled" />
            </test>

            <choiceState section="sect260" set="enabled" />
        </section>

        <section id="sect201">
            <sell class="special" price="20" objectId="siyencrown" />
            <sell class="special" price="10" objectId="ironskull" />
            <sell class="special" price="30" objectId="kutyanemerald" />
        </section>

        <section id="sect204">
            <choiceState section="all" set="disabled" />

            <endurance count="-2" />
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect205">
            <choiceState section="sect158" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect158" set="enabled" />
                <choiceState section="sect247" set="disabled" />
            </test>
        </section>

        <section id="sect208">
            <choiceState section="all" set="disabled" />

            <message id="msg-drop-object" text="Drop one item of your choice from your Backpack Items list, or a Weapon if you do not possess any Backpack Items" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] > 0 || ([BACKPACK-ITEMS-ON-ACTIONCHART] == 0 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] > 0)">
                    <message id="msg-drop-object" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-SECTION] > 0 || ([BACKPACK-ITEMS-ON-ACTIONCHART] == 0 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] > 0)">
                    <message id="msg-drop-object" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect209">
            <endurance count="-2" />
        </section>

        <section id="sect210">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiBlast="true" noKaiRay="true" noPsiSurge="true" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect211">
            <test not="true" hasDiscipline="element">
                <choiceState section="sect157" set="disabled" />
            </test>
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect283" set="disabled" />
            </test>
        </section>

        <section id="sect212">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect238" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect84" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect284" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="3" />
            </test>
            <test expression="[ENDURANCE] &lt;= 20">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect213">
            <meal />
        </section>

        <section id="sect214">
            <pick class="money" count="7" />
        </section>

        <section id="sect215">
            <object objectId="kutyanemerald" />
        </section>

        <section id="sect216">
            <pick class="money" count="-2" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect293" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect194" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect218">
            <choiceState section="sect107" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect115" set="disabled" />
            </test>
        </section>

        <section id="sect219">
            <pick class="money" count="-1" />
        </section>

        <section id="sect220">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect141" set="disabled" />
            </test>
            <test not="true" hasDiscipline="anmlmstr">
                <choiceState section="sect168" set="disabled" />
            </test>
            <test canUseBow="false">
                <choiceState section="sect326" set="disabled" />
            </test>
        </section>

        <section id="sect222">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect224">
            <choiceState section="sect317" set="disabled" />
            <test hasDiscipline="herbmst">
                <choiceState section="sect317" set="enabled" />
                <choiceState section="sect228" set="disabled" />
            </test>
        </section>

        <section id="sect225">
            <endurance count="-6" />
        </section>

        <section id="sect227">
            <endurance count="-2" />
        </section>

        <section id="sect230">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="1" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect231">
            <endurance count="-2" />
        </section>

        <section id="sect232">
            <pick class="money" count="-10" />
            <choiceState section="sect329" set="disabled" />
            <test hasDiscipline="gnosis">
                <choiceState section="sect329" set="enabled" />
                <choiceState section="sect301" set="disabled" />
            </test>            
        </section>

        <section id="sect233">
            <drop backpackItemSlots="last" />
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect98" set="disabled" />
            </test>    
        </section>

        <section id="sect238">
            <endurance count="-5" />
            <test canUseBow="false">
                <choiceState section="sect136" set="disabled" />
            </test>  
        </section>

        <section id="sect239">
            <endurance count="-3" />
        </section>

        <section id="sect241">
            <meal />
        </section>

        <section id="sect242">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect243">
            <drop objectId="cowana"/>
            <endurance count="-3" />
        </section>

        <section id="sect244">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case to="5">
                    <choiceState section="sect71" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect49" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
        </section>

        <section id="sect246">
            <endurance count="-4" />
        </section>

        <section id="sect248">
            <endurance count="-2" />

            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect249">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect251">
            <test expression="[MONEY] == 0">
                <choiceState section="sect182" set="disabled" />
            </test>
            <test expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0">
                <choiceState section="sect277" set="disabled" />
            </test>
            <test expression="[SPECIAL-ITEMS-ON-ACTIONCHART] == 0">
                <choiceState section="sect103" set="disabled" />
            </test>
            <test expression="[MONEY] == 0 &amp;&amp; [BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0 &amp;&amp; [SPECIAL-ITEMS-ON-ACTIONCHART] == 0">
                <textToChoice text="turning to 321" section="sect321" />
            </test>
        </section>

        <section id="sect253">
            <pick class="money" count="-7" />
            <object objectId="meal" unlimited="true" price="2" />
        </section>

        <section id="sect256">
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect98" set="disabled" />
            </test>
        </section>

        <section id="sect257">
            <choiceState section="all" set="disabled" />

            <combat combatSkillModifier="2" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombatTurn turn="1">
                <combat combatSkillModifier="+0" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect260">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect120" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect43" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect60" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 15">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect261">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="2"/>
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombatTurn turn="1">
                <combat combatSkillModifier="0"/>
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect262">
            <meal />
        </section>

        <section id="sect263">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect335" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect27" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect190" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect266">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true"/>
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect268">
            <pick class="money" count="20" />
            <restoreInventoryState restorePoint="book21sect82BowConfiscated" />
        </section>

        <section id="sect269">
            <choiceState section="sect197" set="disabled" />
            <test hasDiscipline="element">
                <choiceState section="sect197" set="enabled" />
                <choiceState section="sect51" set="disabled" />
            </test>
        </section>

        <section id="sect270">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect112" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect9" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect259" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect272">
            <pick class="money" count="7" />
        </section>

        <section id="sect276">
            <endurance count="-5" />
        </section>

        <section id="sect277">
            <message id="msg-drop-object" text="Drop Backpack Items of your choice to restore Endurance points" />
            <choiceSelected section="sect34">
                <endurance count="[BACKPACK-ITEMS-CNT-ON-SECTION] * 3" />
            </choiceSelected>
        </section>

        <section id="sect278">
            <choiceState section="sect42" set="disabled" />
            <test hasDiscipline="hntmstry">
                <choiceState section="sect42" set="enabled" />
                <choiceState section="sect306" set="disabled" />
            </test>
        </section>

        <section id="sect279">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true"/>
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect280">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect231" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect80" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect282">
            <test not="true" expression="[MONEY] >= 2">
                <choiceState section="sect140" set="disabled" />
            </test>
            <choiceSelected section="sect140">
                <pick class="money" count="-2" />
            </choiceSelected>
        </section>

        <section id="sect283">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect218" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect307" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 25">
                <randomTableIncrement increment="2" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect288">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect46" set="disabled" />
            </test>
        </section>

        <section id="sect291">
            <pick class="money" count="-3" />
        </section>

        <section id="sect292">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect44" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect261" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt;= 20">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect296">
            <pick class="arrow" count="-1" />
            <endurance count="-1" />
        </section>

        <section id="sect297">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect248" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect94" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect298">
            <sell class="special" price="20" objectId="siyencrown" />
            <sell class="special" price="10" objectId="ironskull" />
            <sell class="special" price="30" objectId="kutyanemerald" />
        </section>

        <section id="sect299">
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect303" set="disabled" />
            </test>
            <test not="true" hasDiscipline="element">
                <choiceState section="sect210" set="disabled" />
            </test>
        </section>

        <section id="sect300">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <test currentWeapon="kaistar">
                <combat combatSkillModifier="+2"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect302">
            <test hasObject="temujunsring">
                <choiceState section="sect143" set="disabled" />
            </test>
            <test not="true" hasObject="temujunsring">
                <choiceState section="sect118" set="disabled" />
            </test>
        </section>

        <section id="sect303">
            <choiceState section="all" set="disabled" />
            <combat noKaiBlast="true" noKaiRay="true" noMindblast="true" noPsiSurge="true" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect304">
            <death />
        </section>

        <section id="sect308">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect44" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect261" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt;= 20">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect310">
            <test not="true" hasObject="ironskull|kutyanemerald|siyencrown">
                <choiceState section="sect54" set="disabled" />
            </test>
        </section>

        <section id="sect314">
            <meal />
        </section>

        <section id="sect315">
            <test not="true" canUseBow="true">
                <choiceState section="sect244" set="disabled" />
            </test>
        </section>

        <section id="sect317">
            <object objectId="cowana" index="0" />
            <object objectId="cowana" index="1" />
            <object objectId="cowana" index="2" />
        </section>

        <section id="sect318">
            <drop backpackItemSlots="1" />
        </section>

        <section id="sect319">
            <endurance count="-4" />
        </section>

        <section id="sect320">
            <pick class="arrow" count="-1" />
            <death />
        </section>

        <section id="sect321">
            <test expression="([MONEY]) &lt; 4">
                <choiceState section="sect138" set="disabled" />
            </test>
            <test expression="([MONEY]) &lt; 2">
                <choiceState section="all" set="disabled" />
                <message id="msg-drop-object" text="Drop one item of your choice to pay for a Standard room before continuing" />

                <onInventoryEvent>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] > 0 || [WEAPON-ITEMS-CNT-ON-SECTION] > 0 || [SPECIAL-ITEMS-ON-SECTION] > 0">
                        <message id="msg-drop-object" op="hide" />
                        <choiceState section="sect216" set="enabled" />
                    </test>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 0 &amp;&amp; [WEAPON-ITEMS-CNT-ON-SECTION] == 0 &amp;&amp; [SPECIAL-ITEMS-ON-SECTION] == 0">
                        <message id="msg-drop-object" op="show" />
                        <choiceState section="sect216" set="disabled" />
                    </test>
                </onInventoryEvent>
            </test>
        </section>

        <section id="sect322">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect81" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect154" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect222" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
        </section>

        <section id="sect324">
            <object objectId="laumspurpotion4" price="3" />
            <object objectId="potiongallowbrush" price="3" />
            <object objectId="potionofstrength" price="3" />
        </section>

        <section id="sect325">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect146" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect252" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect326">
            <choiceState section="sect107" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect115" set="disabled" />
            </test>
        </section>

        <section id="sect328">
            <pick class="money" count="-10"/>
        </section>

        <section id="sect330">
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect331">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" />
            <test currentWeapon="sunstrike">
                <combat combatSkillModifier="+1"/>
            </test>
            <afterElude>
                <choiceState section="sect13" set="enabled" />
            </afterElude>
            <afterCombats>
                <choiceState section="sect97" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect333">
            <test expression="[MONEY] &lt; 1">
                <choiceState section="sect69" set="disabled" />
            </test>
            <choiceSelected section="sect69">
                <pick class="money" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect335">
            <choiceState section="sect158" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect158" set="enabled" />
                <choiceState section="sect247" set="disabled" />
            </test>
        </section>

        <section id="sect337">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect32" set="enabled" />
                </case>
                <case from="3" to="4">
                    <choiceState section="sect196" set="enabled" />
                </case>
                <case from="5" to="7">
                    <choiceState section="sect256" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect111" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="3" />
            </test>
            <test hasDiscipline="gnosis">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect338">
            <test expression="[MONEY] == 0">
                <message id="msg-drop-object" text="Drop one Backpack Item of your choice to pay the toll" />
                <onInventoryEvent>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] > 0">
                        <message id="msg-drop-object" op="hide" />
                        <choiceState section="all" set="enabled" />
                    </test>
                    <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 0">
                        <message id="msg-drop-object" op="show" />
                        <choiceState section="all" set="disabled" />
                    </test>
                </onInventoryEvent>
            </test>
            <test expression="[MONEY] > 0">
                <pick class="money" count="-1"/>
            </test>
            <endurance count="-3" />
        </section>

        <section id="sect340">
            <!-- TODO: Restore Weapons from ?? -->
        </section>

        <section id="sect341">
            <endurance count="-4" />
        </section>

        <section id="sect342">
            <endurance count="-15" />
        </section>

        <section id="sect345">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect266" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect279" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[BOWBONUS]" />
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect346">
            <pick class="money" count="-1" />
        </section>

        <section id="sect347">
            <endurance count="3" />
            <object objectId="meal" />
        </section>

        <section id="sect348">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect349">
            <meal />
        </section>
    </sections>
</mechanics>